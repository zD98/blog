(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{205:function(t,s,a){t.exports=a.p+"assets/img/demo1.8873018f.gif"},206:function(t,s,a){t.exports=a.p+"assets/img/lironghao.a6ca7cb6.jpg"},207:function(t,s,a){t.exports=a.p+"assets/img/link.d8255c53.png"},208:function(t,s,a){t.exports=a.p+"assets/img/fiber.91add334.png"},209:function(t,s,a){t.exports=a.p+"assets/img/demo2.212f56f9.gif"},210:function(t,s,a){t.exports=a.p+"assets/img/effect.7245f335.png"},211:function(t,s,a){t.exports=a.p+"assets/img/demo3.71781903.gif"},212:function(t,s,a){t.exports=a.p+"assets/img/flow.3f31836f.png"},217:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"react-hooks-从入门到放弃"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#react-hooks-从入门到放弃"}},[t._v("#")]),t._v(" React Hooks 从入门到放弃")]),t._v(" "),n("blockquote",[n("p",[t._v("本文默认读者对 React Hooks 已经有一定的了解。 因此不再赘述 Hooks API 的使用了, 还未了解的同学可以去官网阅读"),n("a",{attrs:{href:"https://reactjs.org/docs/hooks-reference.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("React Hooks API Reference"),n("OutboundLink")],1)])]),t._v(" "),n("h2",{attrs:{id:"react-hooks-基础"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#react-hooks-基础"}},[t._v("#")]),t._v(" React Hooks 基础")]),t._v(" "),n("p",[t._v("使用 React Hooks 就不得不提到 React 函数组件。")]),t._v(" "),n("blockquote",[n("p",[t._v("Conceptually, components are like JavaScript functions. They accept arbitrary inputs (called “props”) and return React elements describing what should appear on the screen.")])]),t._v(" "),n("p",[t._v("从官网上的介绍来看, 组件就像 JavaScript 的函数, 它接收一些入参(props), 并返回 React 元素。")]),t._v(" "),n("p",[t._v("在我们最初学习使用 React 框架时, 首先了解的是通过"),n("code",[t._v("Class")]),t._v("书写组件, 这样可以很好地理解并规划"),n("code",[t._v("类组件")]),t._v("的数据与方法, 而且"),n("code",[t._v("生命周期")]),t._v("可以让我们更清晰地了解组件的加载以及更新状态的触发时机。")]),t._v(" "),n("p",[t._v("那"),n("code",[t._v("函数组件")]),t._v("呢? "),n("code",[t._v("函数组件")]),t._v("本身解决了从数据到 React 元素的映射, 而"),n("code",[t._v("Hooks")]),t._v("则在此基础上提供了数据存储以及 Side Effect(副作用)的处理。")]),t._v(" "),n("p",[t._v("此时此刻, 让我们忘记已经熟知的"),n("code",[t._v("Class")]),t._v("与"),n("code",[t._v("生命周期")]),t._v(", 来重新认识"),n("code",[t._v("函数组件")]),t._v(" + "),n("code",[t._v("Hooks")]),t._v("的 React。")]),t._v(" "),n("h3",{attrs:{id:"_0-函数组件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_0-函数组件"}},[t._v("#")]),t._v(" 0. 函数组件")]),t._v(" "),n("p",[n("code",[t._v("函数组件")]),t._v("是用来处理一些简单的 UI 组件, 通过 Props 传入的数据, 抽象封装一些组件。")]),t._v(" "),n("div",{staticClass:"language-jsx extra-class"},[n("pre",{pre:!0,attrs:{class:"language-jsx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Header")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("props")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" title"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" description"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" avatar "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" props"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("\n            ")]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("img")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),n("span",{pre:!0,attrs:{class:"token script language-javascript"}},[n("span",{pre:!0,attrs:{class:"token script-punctuation punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("avatar"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),n("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("\n            ")]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("h1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("title"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("h1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("\n            ")]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("p")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("description"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("p")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("\n        ")]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("限制了函数组件使用的原因一方面在于它没有内部数据, 另一方面就是没有生命周期, 因此无法实现具有一定交互与逻辑的功能。")]),t._v(" "),n("h3",{attrs:{id:"_1-使用-react-hooks-时的数据存储"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-使用-react-hooks-时的数据存储"}},[t._v("#")]),t._v(" 1. 使用 React Hooks 时的数据存储")]),t._v(" "),n("p",[t._v("函数组件内定义的变量不是固化的, 执行完成后, 函数内的变量就会被清理掉了(非闭包情况)。所以, 我们需要通过 Hooks 固化组件需要的一些数据。")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://codesandbox.io/s/gracious-glitter-p6yyy?autoresize=1&fontsize=14&hidenavigation=1",target:"_blank",rel:"noopener noreferrer"}},[n("img",{attrs:{src:"https://codesandbox.io/static/img/play-codesandbox.svg",alt:"Edit gracious-glitter-p6yyy"}}),n("OutboundLink")],1)]),t._v(" "),n("p",[n("img",{attrs:{src:a(205),alt:"Demo"}})]),t._v(" "),n("p",[t._v("上面是 React Hooks 之 useState 的使用例子, 如下是浅尝辄止的理解:")]),t._v(" "),n("blockquote",[n("p",[t._v("通过"),n("code",[t._v("useState")]),t._v(", 我们在某个地方定义了一个对象, 并挂载到某个不会让它消失的地方。"),n("code",[t._v("useState")]),t._v("方法返回的第一个值就是我们要的数据。"),n("code",[t._v("useState")]),t._v("方法返回的第二个值是一个函数, 可以设置这个对象的值, 然后会触发函数重新渲染。")])]),t._v(" "),n("p",[t._v("上面这坨话说的很模糊, "),n("code",[t._v("某个地方")]),t._v("到底是哪个地方, 定义了一个什么样的"),n("code",[t._v("对象")]),t._v(", 又挂载到了什么地方。设置了新值后又是怎么触发渲染的???")]),t._v(" "),n("p",[n("img",{attrs:{src:a(206),alt:"小小的眼睛装满了大大的疑惑.jpg"}})]),t._v(" "),n("p",[t._v("如果想从根源上填上这个坑, 大概是需要阅读源码了解 Hooks 的基础实现的"),n("a",{attrs:{href:"https://github.com/facebook/react/blob/d259f458133865757c0d18895d537f14908f0a5b/packages/react-reconciler/src/ReactFiberHooks.js#L142",target:"_blank",rel:"noopener noreferrer"}},[t._v("Github 源码链接"),n("OutboundLink")],1),t._v("。")]),t._v(" "),n("p",[t._v("下面是"),n("code",[t._v("Hook")]),t._v("的type定义")]),t._v(" "),n("div",{staticClass:"language-typescript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-typescript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" Hook "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 数据")]),t._v("\n  memoizedState"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("any")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 下面这些暂时不需要了解")]),t._v("\n  baseState"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("any")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  baseQueue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Update"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("any")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("any")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  queue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" UpdateQueue"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("any")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("any")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 链表下一个节点的指针")]),t._v("\n  next"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Hook "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("我们需要了解的是"),n("code",[t._v("Hook")]),t._v("是通过"),n("code",[t._v("链表")]),t._v("存储的\n"),n("img",{attrs:{src:a(207),alt:""}})]),t._v(" "),n("p",[t._v("本文尝试通过流程图来简述下这里的逻辑。(下面的流程图是不完整的!没有对比依赖更新)")]),t._v(" "),n("p",[n("img",{attrs:{src:a(208),alt:"有点问题的Hooks加载流程"}})]),t._v(" "),n("ul",[n("li",[t._v("函数组件第一次执行时")])]),t._v(" "),n("p",[t._v("第一个 Hook 会挂载到"),n("code",[t._v("React Fiber Node")]),t._v("上, 之后在函数执行遇到的 Hook 会依次按顺序挂载到 Hook 节点后。")]),t._v(" "),n("ul",[n("li",[t._v("函数组件更新渲染时")])]),t._v(" "),n("p",[t._v("函数执行遇到的 Hooks 会按照顺序读取"),n("code",[t._v("React Fiber Node")]),t._v("上的 Hook 节点。")]),t._v(" "),n("p",[t._v("如上图所示, 函数组件重新执行时是依赖 Hooks 队列的顺序的。如果在"),n("code",[t._v("条件判断")]),t._v("中使用 Hook 就会让这个队列错乱。")]),t._v(" "),n("p",[t._v("因此也就会有如下官网提示:")]),t._v(" "),n("blockquote",[n("p",[t._v("Only call Hooks at the top level. Don’t call Hooks inside loops, conditions, or nested functions.")])]),t._v(" "),n("h3",{attrs:{id:"_2-使用-react-hooks-处理副作用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-使用-react-hooks-处理副作用"}},[t._v("#")]),t._v(" 2. 使用 React Hooks 处理副作用")]),t._v(" "),n("p",[t._v("副作用(Side Effect), 个人理解, 是在"),n("code",[t._v("数据->视图")]),t._v("的转化过程中, 出现的一些特别的"),n("code",[t._v("时机")]),t._v("。我们可以利用这些"),n("code",[t._v("时机")]),t._v("去处理一些业务逻辑。")]),t._v(" "),n("p",[t._v("以下是使用"),n("code",[t._v("useEffect")]),t._v("的一个简单的计数 Demo.")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://codesandbox.io/s/old-butterfly-2c2ti?fontsize=14&hidenavigation=1&theme=dark",target:"_blank",rel:"noopener noreferrer"}},[n("img",{attrs:{src:"https://codesandbox.io/static/img/play-codesandbox.svg",alt:"Edit old-butterfly-2c2ti"}}),n("OutboundLink")],1)]),t._v(" "),n("p",[n("img",{attrs:{src:a(209),alt:""}})]),t._v(" "),n("p",[t._v("使用"),n("code",[t._v("useEffect")]),t._v("去实现在渲染完成之后要去处理的一些事情。\n大家也可以在官网的API Reference中找到React useEffect说明。")]),t._v(" "),n("p",[t._v("我们可以通过流程图加深理解"),n("code",[t._v("useEffect")]),t._v("这个Hook。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(210),alt:""}})]),t._v(" "),n("p",[t._v("以上是"),n("code",[t._v("useEffect")]),t._v("Hook的大致执行逻辑, 通过此图会发现"),n("code",[t._v("useEffect")]),t._v("多了一步"),n("code",[t._v("数据比对")]),t._v("的过程, 只有当以下条件成立时, SideEffect才会触发调用。")]),t._v(" "),n("ol",[n("li",[t._v("useEffect第一次执行之时")]),t._v(" "),n("li",[t._v("useEffect的依赖存在变更之时")])]),t._v(" "),n("p",[t._v("我们修改上面计数的例子就可以更好的理解两个Hook。")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://codesandbox.io/s/priceless-water-w2r4b?fontsize=14&hidenavigation=1&theme=dark",target:"_blank",rel:"noopener noreferrer"}},[n("img",{attrs:{src:"https://codesandbox.io/static/img/play-codesandbox.svg",alt:"Edit priceless-water-w2r4b"}}),n("OutboundLink")],1)]),t._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Demo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("props")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("count"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" setCount"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("useState")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("step"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" setStep"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("useState")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("useEffect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" timer "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setCount")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("step "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" count"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("clearTimeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("timer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("count"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("div"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("div"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("Count"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("count"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("div"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("div"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("Step"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("step"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("div"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("button\n        onClick"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setCount")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("count "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n        Click\n      "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("button"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("div"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[n("img",{attrs:{src:a(211),alt:""}})]),t._v(" "),n("p",[t._v("在Gift图中, 在更新Step步长时, 计数第一次仍然是"),n("code",[t._v("+1")]),t._v(", 随后才会"),n("code",[t._v("+2")]),t._v("。")]),t._v(" "),n("ol",[n("li",[t._v("在"),n("code",[t._v("step")]),t._v("更新时, "),n("code",[t._v("useEffect")]),t._v("的"),n("code",[t._v("count")]),t._v("没有变化, 所以没有触发更新")]),t._v(" "),n("li",[n("code",[t._v("useEffect")]),t._v("触发时, 使用的是Hook中暂存的数据, 所以步长"),n("code",[t._v("step")]),t._v("仍然是1.")])]),t._v(" "),n("p",[t._v("所以,\n函数组件的流程认知要"),n("strong",[t._v("Update")]),t._v("下\n"),n("img",{attrs:{src:a(212),alt:""}})]),t._v(" "),n("h3",{attrs:{id:"_3-总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-总结"}},[t._v("#")]),t._v(" 3. 总结")]),t._v(" "),n("p",[t._v("本文只是提到了"),n("code",[t._v("useState")]),t._v(", "),n("code",[t._v("useEffect")]),t._v("这两例典型的React Hooks。")]),t._v(" "),n("p",[t._v("以"),n("code",[t._v("useState")]),t._v("为例, 我们了解了"),n("code",[t._v("React Hooks")]),t._v("是如何解决函数组件内无法保留内部数据的问题。")]),t._v(" "),n("p",[t._v("以"),n("code",[t._v("useEffect")]),t._v("为例, 我们呢了解了"),n("code",[t._v("React Hooks")]),t._v("如何处理在"),n("code",[t._v("数据->视图")]),t._v("之间一些"),n("code",[t._v("时机")]),t._v("的处理")]),t._v(" "),n("p",[t._v("以及很浅显的提到了"),n("code",[t._v("Hook")]),t._v("中的数据暂存(快照)的原因")]),t._v(" "),n("p",[t._v("React Hooks还有很多种用法, 本章只是梳理React Hooks的一些基本概念。")]),t._v(" "),n("p",[t._v("下一章会着重于《如何在业务中梳理重组封装自己的Hooks》")]),t._v(" "),n("h2",{attrs:{id:"hooks-的合理使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#hooks-的合理使用"}},[t._v("#")]),t._v(" Hooks 的合理使用")]),t._v(" "),n("h2",{attrs:{id:"usecallback-地狱"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#usecallback-地狱"}},[t._v("#")]),t._v(" UseCallback 地狱")])])}),[],!1,null,null,null);s.default=e.exports}}]);