(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{205:function(t,s,a){t.exports=a.p+"assets/img/demo1.8873018f.gif"},206:function(t,s,a){t.exports=a.p+"assets/img/lironghao.a6ca7cb6.jpg"},207:function(t,s,a){t.exports=a.p+"assets/img/fiber.91add334.png"},208:function(t,s,a){t.exports=a.p+"assets/img/demo2.212f56f9.gif"},209:function(t,s,a){t.exports=a.p+"assets/img/effect.7245f335.png"},210:function(t,s,a){t.exports=a.p+"assets/img/flow.3f31836f.png"},216:function(t,s,a){"use strict";a.r(s);var e=a(0),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"react-hooks-从入门到放弃"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#react-hooks-从入门到放弃"}},[t._v("#")]),t._v(" React Hooks 从入门到放弃")]),t._v(" "),e("blockquote",[e("p",[t._v("本文默认读者对 React Hooks 已经有一定的了解。 因此不再赘述 Hooks API 的使用了, 还未了解的同学可以去官网阅读"),e("a",{attrs:{href:"https://reactjs.org/docs/hooks-reference.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("React Hooks API Reference"),e("OutboundLink")],1)])]),t._v(" "),e("ol",[e("li",[t._v("上手使用")]),t._v(" "),e("li",[t._v("遇到问题")]),t._v(" "),e("li",[t._v("React Hooks 源码分析")]),t._v(" "),e("li",[t._v("函数式组件的思想")]),t._v(" "),e("li",[t._v("抽象封装 Hooks")])]),t._v(" "),e("p",[t._v("这篇文章的目的是什么?")]),t._v(" "),e("ol",[e("li",[t._v("了解 Hooks 原理, 减少使用 Hooks 开发时的 BUG")]),t._v(" "),e("li",[t._v("如何抽象合适的 Hooks")]),t._v(" "),e("li",[t._v("如何书写具有可读性的 React 函数组件")])]),t._v(" "),e("h2",{attrs:{id:"react-hooks-基础"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#react-hooks-基础"}},[t._v("#")]),t._v(" React Hooks 基础")]),t._v(" "),e("p",[t._v("使用 React Hooks 就不得不提到 React 函数组件。")]),t._v(" "),e("blockquote",[e("p",[t._v("Conceptually, components are like JavaScript functions. They accept arbitrary inputs (called “props”) and return React elements describing what should appear on the screen.")])]),t._v(" "),e("p",[t._v("从官网上的介绍来看, 组件就像 JavaScript 的函数, 它接收一些入参(props), 并返回 React 元素。")]),t._v(" "),e("p",[t._v("在我们最初学习使用 React 框架时, 首先了解的是通过"),e("code",[t._v("Class")]),t._v("书写组件, 这样可以很好地理解并规划"),e("code",[t._v("类组件")]),t._v("的数据与方法, 而且"),e("code",[t._v("生命周期")]),t._v("可以让我们更清晰地了解组件的加载以及更新状态的触发时机。")]),t._v(" "),e("p",[t._v("那"),e("code",[t._v("函数组件")]),t._v("呢? "),e("code",[t._v("函数组件")]),t._v("本身解决了从数据到 React 元素的映射, 而"),e("code",[t._v("Hooks")]),t._v("则在此基础上提供了数据存储以及 Side Effect(副作用)的处理。")]),t._v(" "),e("p",[t._v("此时此刻, 让我们忘记已经熟知的"),e("code",[t._v("Class")]),t._v("与"),e("code",[t._v("生命周期")]),t._v(", 来重新认识"),e("code",[t._v("函数组件")]),t._v(" + "),e("code",[t._v("Hooks")]),t._v("的 React。")]),t._v(" "),e("h3",{attrs:{id:"_0-函数组件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_0-函数组件"}},[t._v("#")]),t._v(" 0. 函数组件")]),t._v(" "),e("p",[e("code",[t._v("函数组件")]),t._v("是用来处理一些简单的 UI 组件, 通过 Props 传入的数据, 抽象封装一些组件。")]),t._v(" "),e("div",{staticClass:"language-jsx extra-class"},[e("pre",{pre:!0,attrs:{class:"language-jsx"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Header")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("props")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" title"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" description"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" avatar "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" props"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),e("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("\n            ")]),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("img")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),e("span",{pre:!0,attrs:{class:"token script language-javascript"}},[e("span",{pre:!0,attrs:{class:"token script-punctuation punctuation"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("avatar"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),e("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("\n            ")]),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("h1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("title"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("h1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),e("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("\n            ")]),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("p")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("description"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("p")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),e("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("\n        ")]),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("限制了函数组件使用的原因一方面在于它没有内部数据, 另一方面就是没有生命周期, 因此无法实现具有一定交互与逻辑的功能。")]),t._v(" "),e("h3",{attrs:{id:"_1-使用-react-hooks-时的数据存储"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-使用-react-hooks-时的数据存储"}},[t._v("#")]),t._v(" 1. 使用 React Hooks 时的数据存储")]),t._v(" "),e("p",[t._v("函数组件内定义的变量不是固化的, 执行完成后, 函数内的变量就会被清理掉了(非闭包情况)。所以, 我们需要通过 Hooks 固化组件需要的一些数据。")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://codesandbox.io/s/gracious-glitter-p6yyy?autoresize=1&fontsize=14&hidenavigation=1",target:"_blank",rel:"noopener noreferrer"}},[e("img",{attrs:{src:"https://codesandbox.io/static/img/play-codesandbox.svg",alt:"Edit gracious-glitter-p6yyy"}}),e("OutboundLink")],1)]),t._v(" "),e("p",[e("img",{attrs:{src:a(205),alt:"Demo"}})]),t._v(" "),e("p",[t._v("上面是 React Hooks 之 useState 的使用例子, 如下是浅尝辄止的理解:")]),t._v(" "),e("blockquote",[e("p",[t._v("通过"),e("code",[t._v("useState")]),t._v(", 我们在某个地方定义了一个对象, 并挂载到某个不会让它消失的地方。"),e("code",[t._v("useState")]),t._v("方法返回的第一个值就是我们要的数据。"),e("code",[t._v("useState")]),t._v("方法返回的第二个值是一个函数, 可以设置这个对象的值, 然后会触发函数重新渲染。")])]),t._v(" "),e("p",[t._v("上面这坨话说的很模糊, "),e("code",[t._v("某个地方")]),t._v("到底是哪个地方, 定义了一个什么样的"),e("code",[t._v("对象")]),t._v(", 又挂载到了什么地方。设置了新值后又是怎么触发渲染的???")]),t._v(" "),e("p",[e("img",{attrs:{src:a(206),alt:"小小的眼睛装满了大大的疑惑.jpg"}})]),t._v(" "),e("p",[t._v("如果想从根源上填上这个坑, 大概是需要阅读源码了解 Hooks 的基础实现的"),e("a",{attrs:{href:"https://github.com/facebook/react/blob/d259f458133865757c0d18895d537f14908f0a5b/packages/react-reconciler/src/ReactFiberHooks.js#L142",target:"_blank",rel:"noopener noreferrer"}},[t._v("Github 源码链接"),e("OutboundLink")],1),t._v("。")]),t._v(" "),e("p",[t._v("本文尝试通过流程图来简述下这里的逻辑。(下面的流程图是不完整的!没有对比依赖更新)")]),t._v(" "),e("p",[e("img",{attrs:{src:a(207),alt:"有点问题的Hooks加载流程"}})]),t._v(" "),e("ul",[e("li",[t._v("函数组件第一次执行时")])]),t._v(" "),e("p",[t._v("第一个 Hook 会挂载到"),e("code",[t._v("React Fiber Node")]),t._v("上, 之后在函数执行遇到的 Hook 会依次按顺序挂载到 Hook 节点后。")]),t._v(" "),e("ul",[e("li",[t._v("函数组件更新渲染时")])]),t._v(" "),e("p",[t._v("函数执行遇到的 Hooks 会按照顺序读取"),e("code",[t._v("React Fiber Node")]),t._v("上的 Hook 节点。")]),t._v(" "),e("p",[t._v("如上图所示, 函数组件重新执行时是依赖 Hooks 队列的顺序的。如果在"),e("code",[t._v("条件判断")]),t._v("中使用 Hook 就会让这个队列错乱。")]),t._v(" "),e("p",[t._v("因此也就会有如下官网提示:")]),t._v(" "),e("blockquote",[e("p",[t._v("Only call Hooks at the top level. Don’t call Hooks inside loops, conditions, or nested functions.")])]),t._v(" "),e("h3",{attrs:{id:"_2-使用-react-hooks-处理副作用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-使用-react-hooks-处理副作用"}},[t._v("#")]),t._v(" 2. 使用 React Hooks 处理副作用")]),t._v(" "),e("p",[t._v("副作用(Side Effect), 个人理解, 是在"),e("code",[t._v("数据->视图")]),t._v("的转化过程中, 出现的一些特别的"),e("code",[t._v("时机")]),t._v("。我们可以利用这些"),e("code",[t._v("时机")]),t._v("去处理一些业务逻辑。")]),t._v(" "),e("p",[t._v("以下是使用"),e("code",[t._v("useEffect")]),t._v("的一个简单的计数 Demo.")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://codesandbox.io/s/old-butterfly-2c2ti?fontsize=14&hidenavigation=1&theme=dark",target:"_blank",rel:"noopener noreferrer"}},[e("img",{attrs:{src:"https://codesandbox.io/static/img/play-codesandbox.svg",alt:"Edit old-butterfly-2c2ti"}}),e("OutboundLink")],1)]),t._v(" "),e("p",[e("img",{attrs:{src:a(208),alt:""}})]),t._v(" "),e("p",[t._v("使用"),e("code",[t._v("useEffect")]),t._v("去实现在渲染完成之后要去处理的一些事情。\n大家也可以在官网的API Reference中找到React useEffect说明。")]),t._v(" "),e("p",[t._v("我们可以通过流程图加深理解"),e("code",[t._v("useEffect")]),t._v("这个Hook。")]),t._v(" "),e("p",[e("img",{attrs:{src:a(209),alt:""}})]),t._v(" "),e("p",[t._v("以上是"),e("code",[t._v("useEffect")]),t._v("Hook的大致执行逻辑, 通过此图会发现"),e("code",[t._v("useEffect")]),t._v("多了一步"),e("code",[t._v("数据比对")]),t._v("的过程, 只有当以下条件成立时, SideEffect才会触发调用。")]),t._v(" "),e("ol",[e("li",[t._v("useEffect第一次执行之时")]),t._v(" "),e("li",[t._v("useEffect的依赖存在变更之时")])]),t._v(" "),e("p",[t._v("我们修改上面计数的例子就可以更好的理解两个Hook。")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://codesandbox.io/s/priceless-water-w2r4b?fontsize=14&hidenavigation=1&theme=dark",target:"_blank",rel:"noopener noreferrer"}},[e("img",{attrs:{src:"https://codesandbox.io/static/img/play-codesandbox.svg",alt:"Edit priceless-water-w2r4b"}}),e("OutboundLink")],1)]),t._v(" "),e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Demo")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("props")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("count"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" setCount"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("useState")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("step"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" setStep"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("useState")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("useEffect")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" timer "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("setCount")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("step "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" count"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("clearTimeout")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("timer"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("count"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("div"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("div"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("Count"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("count"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("div"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("div"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("Step"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("step"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("div"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("button\n        onClick"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("setCount")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("count "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n        Click\n      "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("button"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("div"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("在Gift图中, 在更新Step步长时, 计数第一次仍然是"),e("code",[t._v("+1")]),t._v(", 随后才会"),e("code",[t._v("+2")]),t._v("。")]),t._v(" "),e("ol",[e("li",[t._v("在"),e("code",[t._v("step")]),t._v("更新时, "),e("code",[t._v("useEffect")]),t._v("的"),e("code",[t._v("count")]),t._v("没有变化, 所以没有触发更新")]),t._v(" "),e("li",[e("code",[t._v("useEffect")]),t._v("触发时, 使用的是Hook中暂存的数据, 所以步长"),e("code",[t._v("step")]),t._v("仍然是1.")])]),t._v(" "),e("p",[t._v("所以,\n函数组件的流程认知要"),e("strong",[t._v("Update")]),t._v("下\n"),e("img",{attrs:{src:a(210),alt:""}})]),t._v(" "),e("h3",{attrs:{id:"_3-总结"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-总结"}},[t._v("#")]),t._v(" 3. 总结")]),t._v(" "),e("p",[t._v("本文只是提到了"),e("code",[t._v("useState")]),t._v(", "),e("code",[t._v("useEffect")]),t._v("这两例典型的React Hooks。")]),t._v(" "),e("p",[t._v("以"),e("code",[t._v("useState")]),t._v("为例, 我们了解了"),e("code",[t._v("React Hooks")]),t._v("是如何解决函数组件内无法保留内部数据的问题。\n以"),e("code",[t._v("useEffect")]),t._v("为例, 我们呢了解了"),e("code",[t._v("React Hooks")]),t._v("如何处理在"),e("code",[t._v("数据->视图")]),t._v("之间一些"),e("code",[t._v("时机")]),t._v("的处理")]),t._v(" "),e("p",[t._v("以及很浅显的提到了"),e("code",[t._v("Hook")]),t._v("中的数据暂存(快照)的原因")]),t._v(" "),e("p",[t._v("下一章会着重于《如何在业务中梳理重组封装自己的Hooks》")]),t._v(" "),e("h2",{attrs:{id:"hooks-的合理使用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#hooks-的合理使用"}},[t._v("#")]),t._v(" Hooks 的合理使用")]),t._v(" "),e("p",[t._v("简单粗暴的改写 Class 组件, 代码对比")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("// TODO: 冗长的Function代码\n")])])]),e("p",[t._v("按照官网提供的 Hooks API, 我们将一个 Class 组件改造成了 Function + Hooks 组件")]),t._v(" "),e("p",[t._v("看上去这个函数很混乱, 可读性也很差, 那使用 React Hooks 真的优雅吗？")]),t._v(" "),e("p",[t._v("那看下面这份代码")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("// TODO: 重构Function的代码\n")])])]),e("blockquote",[e("p",[t._v("函数式编程是一种编程范式，它将电脑运算视为函数运算，并且避免使用程序状态以及易变对象。其中，λ 演算（lambda calculus）为该语言最重要的基础。而且，λ 演算的函数可以接受函数当作输入（引数）和输出（传出值）。\n比起指令式编程，函数式编程更加强调程序执行的结果而非执行的过程，倡导利用若干简单的执行单元让计算结果不断渐进，逐层推导复杂的运算，而不是设计一个复杂的执行过程。")])]),t._v(" "),e("p",[t._v("函数式思维的一种转换: 输入与输出")]),t._v(" "),e("p",[t._v("每一次渲染都是"),e("code",[t._v("来源 -> 数据变更 -> 视图 -> 执行SideEffect")]),t._v("的过程, 这是一条主流, 那可以进行如下重组:")]),t._v(" "),e("p",[t._v("多个(数据, 来源, 副作用) => 视图 === 来源 ->数据变更 -> 视图 -> 执行 SideEffect")]),t._v(" "),e("h2",{attrs:{id:"usecallback-地狱"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#usecallback-地狱"}},[t._v("#")]),t._v(" UseCallback 地狱")])])}),[],!1,null,null,null);s.default=n.exports}}]);